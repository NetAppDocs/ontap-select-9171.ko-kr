---
sidebar: sidebar 
permalink: concept_stor_hwraid_local.html 
keywords: ontap select, hardware raid, performance boost, protection 
summary: 하드웨어 RAID 컨트롤러를 사용할 수 있는 경우, ONTAP Select 쓰기 성능 향상과 물리적 드라이브 장애 방지를 위해 RAID 서비스를 하드웨어 컨트롤러로 이전할 수 있습니다. 따라서 ONTAP Select 클러스터 내 모든 노드에 대한 RAID 보호는 ONTAP 소프트웨어 RAID가 아닌 로컬로 연결된 RAID 컨트롤러를 통해 제공됩니다. 
---
= ONTAP Select 로컬 연결 스토리지를 위한 하드웨어 RAID 서비스
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
하드웨어 RAID 컨트롤러를 사용할 수 있는 경우, ONTAP Select 쓰기 성능 향상과 물리적 드라이브 장애 방지를 위해 RAID 서비스를 하드웨어 컨트롤러로 이전할 수 있습니다. 따라서 ONTAP Select 클러스터 내 모든 노드에 대한 RAID 보호는 ONTAP 소프트웨어 RAID가 아닌 로컬로 연결된 RAID 컨트롤러를 통해 제공됩니다.


NOTE: ONTAP Select 데이터 집계는 물리적 RAID 컨트롤러가 기본 드라이브에 RAID 스트라이핑을 제공하므로 RAID 0을 사용하도록 구성됩니다. 다른 RAID 수준은 지원되지 않습니다.



== 로컬 연결 스토리지에 대한 RAID 컨트롤러 구성

백업 스토리지를 갖춘 ONTAP Select 제공하는 모든 로컬 연결 디스크는 RAID 컨트롤러 뒤에 있어야 합니다. 대부분의 상용 서버는 다양한 가격대에 걸쳐 다양한 RAID 컨트롤러 옵션을 제공하며, 각 옵션마다 기능 수준이 다릅니다. 컨트롤러에 대한 최소 요구 사항을 충족하는 한, 이러한 옵션을 최대한 많이 지원하는 것이 목표입니다.


NOTE: 하드웨어 RAID 구성을 사용하는 ONTAP Select VM에서는 가상 디스크를 분리할 수 없습니다. 디스크 분리는 소프트웨어 RAID 구성을 사용하는 ONTAP Select VM에서만 지원됩니다. 보다link:task_adm_replace_drives_swraid.html["ONTAP Select 소프트웨어 RAID 구성에서 실패한 드라이브 교체"] 자세한 내용은.

ONTAP Select 디스크를 관리하는 RAID 컨트롤러는 다음 요구 사항을 충족해야 합니다.

* 하드웨어 RAID 컨트롤러에는 배터리 백업 장치(BBU) 또는 플래시백 쓰기 캐시(FBWC)가 있어야 하며 12Gbps의 처리량을 지원해야 합니다.
* RAID 컨트롤러는 최소한 1~2개의 디스크 장애를 견딜 수 있는 모드(RAID 5 및 RAID 6)를 지원해야 합니다.
* 드라이브 캐시를 비활성화해야 합니다.
* 쓰기 정책은 BBU 또는 플래시 장애 발생 시 쓰기를 다시 수행할 수 있는 쓰기 저장 모드로 구성되어야 합니다.
* 읽기에 대한 I/O 정책은 캐시로 설정되어야 합니다.


백업 스토리지를 갖춘 ONTAP Select 제공하는 모든 로컬 연결 디스크는 RAID 5 또는 RAID 6을 실행하는 RAID 그룹에 배치해야 합니다. SAS 드라이브 및 SSD의 경우, 최대 24개 드라이브로 구성된 RAID 그룹을 사용하면 ONTAP 수신되는 읽기 요청을 더 많은 디스크로 분산하는 이점을 얻을 수 있습니다. 이를 통해 성능이 크게 향상됩니다. SAS/SSD 구성의 경우, 단일 LUN 구성과 다중 LUN 구성을 비교하여 성능 테스트를 수행했습니다. 유의미한 차이는 발견되지 않았으므로, NetApp 단순화를 위해 구성 요구 사항을 충족하는 데 필요한 최소한의 LUN만 생성할 것을 권장합니다.

NL-SAS 및 SATA 드라이브는 서로 다른 모범 사례가 필요합니다. 성능상의 이유로 최소 디스크 수는 여전히 8개이지만, RAID 그룹 크기는 12개 드라이브를 초과해서는 안 됩니다. NetApp RAID 그룹당 스페어 디스크를 하나씩 사용할 것을 권장하지만, 모든 RAID 그룹에 글로벌 스페어 디스크를 사용할 수도 있습니다. 예를 들어, 각 RAID 그룹을 8~12개의 드라이브로 구성하고 RAID 그룹 3개마다 스페어 디스크 2개를 사용할 수 있습니다.


NOTE: 이전 ESX 릴리스의 최대 범위 및 데이터 저장소 크기는 64TB이며, 이는 이러한 대용량 드라이브에서 제공하는 총 원시 용량을 지원하는 데 필요한 LUN 수에 영향을 미칠 수 있습니다.



== RAID 모드

많은 RAID 컨트롤러는 최대 세 가지 작동 모드를 지원하며, 각 모드는 쓰기 요청의 데이터 경로에 상당한 차이를 나타냅니다. 세 가지 모드는 다음과 같습니다.

* Writethrough. 모든 수신 I/O 요청은 RAID 컨트롤러 캐시에 기록된 후 호스트에 요청을 확인하기 전에 즉시 디스크에 플러시됩니다.
* 쓰기 우회. 모든 수신 I/O 요청은 RAID 컨트롤러 캐시를 우회하여 디스크에 직접 기록됩니다.
* 쓰기 저장(Writeback). 모든 수신 I/O 요청은 컨트롤러 캐시에 직접 기록되고 즉시 호스트에 확인 응답됩니다. 데이터 블록은 컨트롤러를 통해 비동기적으로 디스크에 플러시됩니다.


쓰기 저장 모드는 가장 짧은 데이터 경로를 제공하며, 블록이 캐시에 입력되는 즉시 I/O 확인이 이루어집니다. 이 모드는 혼합 읽기/쓰기 워크로드에서 가장 낮은 지연 시간과 가장 높은 처리량을 제공합니다. 그러나 BBU 또는 비휘발성 플래시 기술이 없으면 이 모드에서 작동 중 시스템에 정전이 발생할 경우 데이터 손실 위험이 있습니다.

ONTAP Select 배터리 백업이나 플래시 장치를 필요로 하므로, 이러한 유형의 장애 발생 시 캐시된 블록이 디스크로 플러시될 것이라고 확신할 수 있습니다. 따라서 RAID 컨트롤러를 쓰기 저장 모드로 구성하는 것이 필수입니다.



== ONTAP Select 와 OS 간에 공유되는 로컬 디스크

가장 일반적인 서버 구성은 로컬로 연결된 모든 스핀들이 단일 RAID 컨트롤러 뒤에 위치하는 구성입니다. 최소 두 개의 LUN을 프로비저닝해야 합니다. 하나는 하이퍼바이저용이고 다른 하나는 ONTAP Select VM용입니다.

예를 들어, 내장 드라이브 6개와 Smart Array P420i RAID 컨트롤러 1개가 있는 HP DL380 g8을 생각해 보겠습니다. 모든 내장 드라이브는 이 RAID 컨트롤러에 의해 관리되며, 시스템에는 다른 스토리지가 없습니다.

다음 그림은 이러한 구성 스타일을 보여줍니다. 이 예에서는 시스템에 다른 스토리지가 없으므로 하이퍼바이저는 ONTAP Select 노드와 스토리지를 공유해야 합니다.

*RAID 관리 스핀들만 있는 서버 LUN 구성*

image:ST_08.jpg["RAID 관리 스핀들만 있는 서버 LUN 구성"]

ONTAP Select 와 동일한 RAID 그룹에서 OS LUN을 프로비저닝하면 하이퍼바이저 OS(및 해당 스토리지에서 프로비저닝된 모든 클라이언트 VM)가 RAID 보호의 이점을 누릴 수 있습니다. 이 구성은 단일 드라이브 장애로 인해 전체 시스템이 중단되는 것을 방지합니다.



== ONTAP Select 와 OS 사이에 분할된 로컬 디스크

서버 공급업체가 제공하는 또 다른 가능한 구성은 여러 개의 RAID 또는 디스크 컨트롤러를 사용하여 시스템을 구성하는 것입니다. 이 구성에서는 디스크 세트가 하나의 디스크 컨트롤러에 의해 관리되며, 이 컨트롤러는 RAID 서비스를 제공할 수도 있고 제공하지 않을 수도 있습니다. 두 번째 디스크 세트는 RAID 5/6 서비스를 제공할 수 있는 하드웨어 RAID 컨트롤러에 의해 관리됩니다.

이러한 구성 방식에서는 RAID 컨트롤러 뒤에 위치하며 RAID 5/6 서비스를 제공할 수 있는 스핀들 세트를 ONTAP Select VM에서만 사용해야 합니다. 관리 중인 총 스토리지 용량에 따라 디스크 스핀들을 하나 이상의 RAID 그룹과 하나 이상의 LUN으로 구성해야 합니다. 이러한 LUN을 사용하여 하나 이상의 데이터 저장소를 생성하고, 모든 데이터 저장소는 RAID 컨트롤러에 의해 보호됩니다.

첫 번째 디스크 세트는 다음 그림에서 볼 수 있듯이 하이퍼바이저 OS와 ONTAP 스토리지를 사용하지 않는 모든 클라이언트 VM용으로 예약되어 있습니다.

*혼합 RAID/비 RAID 시스템의 서버 LUN 구성*

image:ST_09.jpg["혼합 RAID/비 RAID 시스템의 서버 LUN 구성"]



== 여러 LUN

단일 RAID 그룹/단일 LUN 구성을 변경해야 하는 두 가지 경우가 있습니다. NL-SAS 또는 SATA 드라이브를 사용하는 경우 RAID 그룹 크기는 12개 드라이브를 초과해서는 안 됩니다. 또한, 단일 LUN은 기본 하이퍼바이저 스토리지 제한(개별 파일 시스템 익스텐트 최대 크기 또는 전체 스토리지 풀 최대 크기)보다 커질 수 있습니다. 이 경우, 파일 시스템을 성공적으로 생성하려면 기본 물리적 스토리지를 여러 LUN으로 분할해야 합니다.



== VMware vSphere 가상 머신 파일 시스템 제한

일부 ESX 버전에서는 데이터 저장소의 최대 크기가 64TB입니다.

서버에 64TB 이상의 스토리지가 연결된 경우, 각각 64TB보다 작은 여러 개의 LUN을 프로비저닝해야 할 수 있습니다. SATA/NL-SAS 드라이브의 RAID 재구축 시간을 단축하기 위해 여러 개의 RAID 그룹을 생성하는 경우에도 여러 개의 LUN이 프로비저닝됩니다.

여러 LUN이 필요한 경우, 각 LUN의 성능이 유사하고 일관되도록 하는 것이 가장 중요합니다. 특히 모든 LUN을 단일 ONTAP 집합으로 사용할 경우 더욱 그렇습니다. 하나 이상의 LUN 중 일부의 성능 프로필이 확연히 다른 경우, 이러한 LUN을 별도의 ONTAP 집합으로 분리하는 것이 좋습니다.

여러 파일 시스템 익스텐트를 사용하여 최대 데이터스토어 크기까지 단일 데이터스토어를 생성할 수 있습니다. ONTAP Select 라이선스가 필요한 용량을 제한하려면 클러스터 설치 중에 용량 제한을 지정해야 합니다. 이 기능을 사용하면 ONTAP Select 데이터스토어 공간의 일부만 사용(따라서 라이선스가 필요함)할 수 있습니다.

또는 단일 LUN에 단일 데이터스토어를 생성하는 것으로 시작할 수 있습니다. 더 큰 ONTAP Select 용량 라이선스가 필요한 추가 공간이 필요한 경우, 해당 공간을 동일한 데이터스토어에 익스텐트로 추가할 수 있으며, 최대 데이터스토어 크기까지 확장할 수 있습니다. 최대 크기에 도달하면 새 데이터스토어를 생성하여 ONTAP Select 에 추가할 수 있습니다. 두 가지 유형의 용량 확장 작업 모두 지원되며, ONTAP Deploy의 스토리지 추가 기능을 사용하여 수행할 수 있습니다. 각 ONTAP Select 노드는 최대 400TB의 스토리지를 지원하도록 구성할 수 있습니다. 여러 데이터스토어에서 용량을 프로비저닝하려면 두 단계의 프로세스가 필요합니다.

초기 클러스터 생성은 초기 데이터 저장소의 일부 또는 전체 공간을 사용하는 ONTAP Select 클러스터를 생성하는 데 사용할 수 있습니다. 두 번째 단계는 원하는 총 용량에 도달할 때까지 추가 데이터 저장소를 사용하여 하나 이상의 용량 추가 작업을 수행하는 것입니다. 이 기능은 섹션에 자세히 설명되어 있습니다.link:concept_stor_capacity_inc.html["저장 용량을 늘리세요"] .


NOTE: VMFS 오버헤드가 0이 아니며(VMware KB 1001618 참조), 데이터스토어에서 사용 가능하다고 보고된 전체 공간을 사용하려고 하면 클러스터 생성 작업 중에 잘못된 오류가 발생합니다.

각 데이터스토어에서 2%의 버퍼가 사용되지 않습니다. 이 공간은 ONTAP Select 에서 사용되지 않으므로 용량 라이선스가 필요하지 않습니다. ONTAP Deploy는 용량 제한이 지정되지 않은 경우 버퍼의 정확한 기가바이트 수를 자동으로 계산합니다. 용량 제한이 지정된 경우 해당 크기가 먼저 적용됩니다. 용량 제한 크기가 버퍼 크기 내에 있으면 클러스터 생성이 실패하고 용량 제한으로 사용할 수 있는 올바른 최대 크기 매개변수를 지정하는 오류 메시지가 표시됩니다.

[listing]
----
“InvalidPoolCapacitySize: Invalid capacity specified for storage pool “ontap-select-storage-pool”, Specified value: 34334204 GB. Available (after leaving 2% overhead space): 30948”
----
VMFS 6은 새로운 설치와 기존 ONTAP Deploy 또는 ONTAP Select VM의 Storage vMotion 작업 대상으로 모두 지원됩니다.

VMware는 VMFS 5에서 VMFS 6으로의 인플레이스 업그레이드를 지원하지 않습니다. 따라서 Storage vMotion은 모든 VM이 VMFS 5 데이터스토어에서 VMFS 6 데이터스토어로 전환할 수 있도록 하는 유일한 메커니즘입니다. 그러나 ONTAP Select 및 ONTAP Deploy를 통한 Storage vMotion 지원은 VMFS 5에서 VMFS 6으로의 전환이라는 특정 목적 외에도 다른 시나리오를 지원하도록 확장되었습니다.



== ONTAP Select

ONTAP Select 핵심은 하나 이상의 스토리지 풀에서 프로비저닝된 가상 디스크 세트를 ONTAP 에 제공한다는 것입니다. ONTAP 은 물리적 디스크로 취급되는 가상 디스크 세트를 제공하며, 스토리지 스택의 나머지 부분은 하이퍼바이저에 의해 추상화됩니다. 다음 그림은 이러한 관계를 더 자세히 보여주며, 물리적 RAID 컨트롤러, 하이퍼바이저, 그리고 ONTAP Select VM 간의 관계를 강조합니다.

* RAID 그룹 및 LUN 구성은 서버의 RAID 컨트롤러 소프트웨어 내에서 이루어집니다. VSAN 또는 외부 어레이를 사용하는 경우에는 이 구성이 필요하지 않습니다.
* 스토리지 풀 구성은 하이퍼바이저 내부에서 이루어집니다.
* 가상 디스크는 개별 VM에 의해 생성되고 소유됩니다. 이 예에서는 ONTAP Select 에 의해 생성됩니다.


*가상 디스크에서 물리적 디스크로의 매핑*

image:ST_12.jpg["가상 디스크에서 물리적 디스크로의 매핑"]



== 가상 디스크 프로비저닝

더욱 간소화된 사용자 환경을 제공하기 위해 ONTAP Select 관리 도구인 ONTAP Deploy는 연결된 스토리지 풀에서 가상 디스크를 자동으로 프로비저닝하여 ONTAP Select VM에 연결합니다. 이 작업은 초기 설정 및 스토리지 추가 작업 시 자동으로 수행됩니다. ONTAP Select 노드가 HA 쌍에 속하는 경우, 가상 디스크는 로컬 및 미러 스토리지 풀에 자동으로 할당됩니다.

ONTAP Select 기본 연결 스토리지를 각각 16TB를 초과하지 않는 동일한 크기의 가상 디스크로 분할합니다. ONTAP Select 노드가 HA 쌍의 일부인 경우, 각 클러스터 노드에 최소 두 개의 가상 디스크가 생성되어 로컬 플렉스와 미러 플렉스에 할당되어 미러링된 통합 환경에서 사용됩니다.

예를 들어, ONTAP Select 31TB(VM이 배포되고 시스템 및 루트 디스크가 프로비저닝된 후 남은 공간)의 데이터스토어 또는 LUN을 할당할 수 있습니다. 그러면 약 7.75TB의 가상 디스크 4개가 생성되어 해당 ONTAP 로컬 및 미러 플렉스에 할당됩니다.


NOTE: ONTAP Select VM에 용량을 추가하면 서로 다른 크기의 VMDK가 생성될 수 있습니다. 자세한 내용은 섹션을 참조하세요.link:concept_stor_capacity_inc.html["저장 용량을 늘리세요"] . FAS 가 다른 VMDK가 동일한 집합체에 존재할 수 있습니다. ONTAP Select 이러한 VMDK에 RAID 0 스트라이프를 사용하여 크기에 관계없이 각 VMDK의 모든 공간을 최대한 활용할 수 있습니다.



== 가상화된 NVRAM

NetApp FAS 시스템은 전통적으로 비휘발성 플래시 메모리를 내장한 고성능 카드인 물리적 NVRAM PCI 카드를 사용합니다. 이 카드는 ONTAP 수신되는 쓰기 요청을 클라이언트로 즉시 인식할 수 있도록 하여 쓰기 성능을 크게 향상시킵니다. 또한, 디스테이징(destaging)이라는 프로세스를 통해 수정된 데이터 블록을 느린 저장 매체로 다시 이동하도록 예약할 수 있습니다.

상용 시스템에는 일반적으로 이러한 유형의 장비가 장착되어 있지 않습니다. 따라서 이 NVRAM 카드의 기능은 가상화되어 ONTAP Select 시스템 부팅 디스크의 파티션에 배치되었습니다. 이러한 이유로 인스턴스의 시스템 가상 디스크 배치가 매우 중요합니다. 또한, 로컬 연결 스토리지 구성을 위해 복원력 있는 캐시를 갖춘 물리적 RAID 컨트롤러가 필요합니다.

NVRAM 자체 VMDK에 배치됩니다. NVRAM 자체 VMDK에 분할하면 ONTAP Select VM이 vNVMe 드라이버를 사용하여 NVRAM VMDK와 통신할 수 있습니다. 또한 ONTAP Select VM은 ESX 6.5 이상과 호환되는 하드웨어 버전 13을 사용해야 합니다.



== 데이터 경로 설명: NVRAM 및 RAID 컨트롤러

가상화된 NVRAM 시스템 파티션과 RAID 컨트롤러 간의 상호 작용은 쓰기 요청이 시스템에 들어올 때 이동하는 데이터 경로를 살펴보면 가장 잘 알 수 있습니다.

ONTAP Select VM으로 들어오는 쓰기 요청은 해당 VM의 NVRAM 파티션을 대상으로 합니다. 가상화 계층에서 이 파티션은 ONTAP Select VM에 연결된 VMDK인 ONTAP Select 시스템 디스크 내에 존재합니다. 물리 계층에서 이러한 요청은 기본 스핀들을 대상으로 하는 모든 블록 변경 사항과 마찬가지로 로컬 RAID 컨트롤러에 캐시됩니다. 여기서 쓰기 요청은 호스트로 다시 확인됩니다.

이 시점에서 물리적으로 블록은 RAID 컨트롤러 캐시에 상주하며 디스크로 플러시되기를 기다리고 있습니다. 논리적으로 블록은 NVRAM 에 상주하며 적절한 사용자 데이터 디스크로 디스테이징되기를 기다리고 있습니다.

변경된 블록은 RAID 컨트롤러의 로컬 캐시에 자동으로 저장되므로, NVRAM 파티션에 들어오는 쓰기는 자동으로 캐시되고 주기적으로 물리적 저장 매체에 플러시됩니다. 이는 NVRAM 내용을 ONTAP 데이터 디스크로 주기적으로 플러시하는 것과 혼동해서는 안 됩니다. 이 두 가지 이벤트는 서로 관련이 없으며 서로 다른 시간과 빈도로 발생합니다.

다음 그림은 들어오는 쓰기 작업의 I/O 경로를 보여줍니다. 물리적 계층(RAID 컨트롤러 캐시 및 디스크로 표현)과 가상 계층(VM의 NVRAM 및 데이터 가상 디스크로 표현)의 차이점을 강조합니다.


NOTE: NVRAM VMDK에서 변경된 블록은 로컬 RAID 컨트롤러 캐시에 캐시되지만, 캐시는 VM 구성이나 해당 가상 디스크를 인식하지 못합니다. 캐시 는 변경된 모든 블록을 시스템에 저장하며, NVRAM 이 시스템의 일부일 뿐입니다. 여기에는 동일한 백업 스핀들에서 프로비저닝된 경우 하이퍼바이저에 바인딩된 쓰기 요청도 포함됩니다.

* ONTAP Select VM에 들어오는 쓰기*

image:ST_13.jpg["ONTAP Select VM에 들어오는 쓰기"]


NOTE: NVRAM 파티션은 자체 VMDK로 분리됩니다. 이 VMDK는 ESX 6.5 이상 버전에서 제공되는 vNVME 드라이버를 사용하여 연결됩니다. 이러한 변경 사항은 RAID 컨트롤러 캐시의 이점을 누리지 못하는 소프트웨어 RAID를 사용하는 ONTAP Select 설치에서 가장 중요합니다.
