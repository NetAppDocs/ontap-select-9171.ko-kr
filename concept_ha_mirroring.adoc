---
sidebar: sidebar 
permalink: concept_ha_mirroring.html 
keywords: ontap select, ha, high availability, synchronous replication, mirrored aggregates, write path, raid syncmirror, rsm 
summary: 'RAID SyncMirror (RSM), 미러링된 집계 및 쓰기 경로를 사용하여 데이터 손실을 방지합니다.' 
---
= ONTAP Select HA RSM 및 미러링된 집계
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
RAID SyncMirror (RSM), 미러링된 집계 및 쓰기 경로를 사용하여 데이터 손실을 방지합니다.



== 동기 복제

ONTAP HA 모델은 HA 파트너 개념을 기반으로 합니다. ONTAP Select ONTAP 에 내장된 RAID SyncMirror (RSM) 기능을 사용하여 클러스터 노드 간에 데이터 블록을 복제함으로써 이 아키텍처를 비공유 상용 서버 환경으로 확장합니다. 이를 통해 HA 쌍에 걸쳐 두 개의 사용자 데이터 복사본을 제공합니다.

중재자가 있는 2노드 클러스터는 두 개의 데이터 센터에 걸쳐 있을 수 있습니다. 자세한 내용은 섹션을 참조하세요.link:reference_plan_best_practices.html#two-node-stretched-ha-metrocluster-sds-best-practices["2노드 확장 HA(MetroCluster SDS) 모범 사례"] .



== 미러링된 집계

ONTAP Select 클러스터는 2개에서 8개의 노드로 구성됩니다. 각 HA 쌍에는 IP 네트워크를 통해 노드 간에 동기적으로 미러링되는 두 개의 사용자 데이터 사본이 포함됩니다. 이 미러링은 사용자에게 투명하며, 데이터 집계 생성 프로세스 중에 자동으로 설정되는 데이터 집계의 속성입니다.

ONTAP Select 클러스터의 모든 집계는 노드 장애 발생 시 데이터 가용성을 확보하고 하드웨어 장애 발생 시 SPOF(Single Point Of Failure)를 방지하기 위해 미러링되어야 합니다. ONTAP Select 클러스터의 집계는 HA 쌍의 각 노드에서 제공하는 가상 디스크를 기반으로 구축되며, 다음 디스크를 사용합니다.

* 디스크의 로컬 세트(현재 ONTAP Select 노드에서 제공)
* 현재 노드의 HA 파트너가 제공하는 미러링된 디스크 세트



NOTE: 미러링된 통합을 구축하는 데 사용되는 로컬 디스크와 미러 디스크는 크기가 동일해야 합니다. 이러한 통합은 로컬 미러 쌍과 원격 미러 쌍을 나타내기 위해 각각 플렉스 0과 플렉스 1로 지칭됩니다. 실제 플렉스 번호는 설치 환경에 따라 다를 수 있습니다.

이 접근 방식은 표준 ONTAP 클러스터의 작동 방식과 근본적으로 다릅니다. 이는 ONTAP Select 클러스터 내의 모든 루트 및 데이터 디스크에 적용됩니다. 집계에는 로컬 및 미러 데이터 복사본이 모두 포함됩니다. 따라서 N개의 가상 디스크를 포함하는 집계는 두 번째 데이터 복사본이 고유한 디스크에 상주하기 때문에 N/2개 디스크에 해당하는 고유한 스토리지를 제공합니다.

다음 그림은 4노드 ONTAP Select 클러스터 내의 HA 쌍을 보여줍니다. 이 클러스터 내에는 두 HA 파트너의 스토리지를 사용하는 단일 집계(테스트)가 있습니다. 이 데이터 집계는 두 개의 가상 디스크 세트로 구성됩니다. 로컬 세트는 ONTAP Select 소유한 클러스터 노드(Plex 0)에서 제공하고, 원격 세트는 장애 조치 파트너(Plex 1)에서 제공합니다.

Plex 0은 모든 로컬 디스크를 저장하는 버킷입니다. Plex 1은 미러 디스크, 즉 사용자 데이터의 두 번째 복제본을 저장하는 디스크를 저장하는 버킷입니다. 집계를 소유한 노드는 Plex 0에 디스크를 제공하고, 해당 노드의 HA 파트너는 Plex 1에 디스크를 제공합니다.

다음 그림은 두 개의 디스크로 구성된 미러링된 집계를 보여줍니다. 이 집계의 내용은 두 클러스터 노드에 미러링되며, 로컬 디스크 NET-1.1은 Plex 0 버킷에, 원격 디스크 NET-2.1은 Plex 1 버킷에 배치됩니다. 이 예에서 집계 test는 왼쪽 클러스터 노드가 소유하며 로컬 디스크 NET-1.1과 HA 파트너 미러 디스크 NET-2.1을 사용합니다.

* ONTAP Select 미러링 집계*image:DDHA_03.jpg["ONTAP Select 미러링 집계"]


NOTE: ONTAP Select 클러스터가 배포되면 시스템에 있는 모든 가상 디스크가 올바른 플렉스에 자동으로 할당되므로 사용자가 디스크 할당과 관련하여 추가 작업을 수행할 필요가 없습니다. 이를 통해 실수로 디스크가 잘못된 플렉스에 할당되는 것을 방지하고 최적의 미러 디스크 구성을 제공합니다.



== 쓰기 경로

클러스터 노드 간 데이터 블록의 동기식 미러링과 시스템 장애 발생 시 데이터 손실이 없어야 한다는 요구 사항은 ONTAP Select 클러스터를 통해 수신되는 쓰기 작업이 전파되는 경로에 상당한 영향을 미칩니다. 이 프로세스는 두 단계로 구성됩니다.

* 승인
* 디스테이징


대상 볼륨에 대한 쓰기는 데이터 LIF(Limited File Initiative)를 통해 수행되며, ONTAP Select 노드의 시스템 디스크에 있는 가상화된 NVRAM 파티션에 커밋된 후 클라이언트에 확인됩니다. HA 구성에서는 이러한 NVRAM 쓰기가 확인되기 전에 대상 볼륨 소유자의 HA 파트너에 즉시 미러링되므로 추가 단계가 필요합니다. 이 프로세스는 원래 노드에 하드웨어 장애가 발생할 경우 HA 파트너 노드의 파일 시스템 일관성을 보장합니다.

쓰기 작업이 NVRAM 에 커밋된 후, ONTAP 이 파티션의 내용을 적절한 가상 디스크로 주기적으로 이동합니다. 이 프로세스를 디스테이징이라고 합니다. 이 프로세스는 대상 볼륨을 소유한 클러스터 노드에서 한 번만 수행되며, HA 파트너에서는 수행되지 않습니다.

다음 그림은 ONTAP Select 노드에 들어오는 쓰기 요청의 쓰기 경로를 보여줍니다.

* ONTAP Select 쓰기 경로 워크플로*image:DDHA_04.jpg["ONTAP Select 쓰기 경로 워크플로"]

수신 쓰기 확인에는 다음 단계가 포함됩니다.

* 쓰기는 ONTAP Select 노드 A가 소유한 논리적 인터페이스를 통해 시스템에 입력됩니다.
* 쓰기는 노드 A의 NVRAM 에 커밋되고 HA 파트너인 노드 B에 미러링됩니다.
* 두 HA 노드 모두에 I/O 요청이 발생하면 해당 요청은 클라이언트에게 다시 확인됩니다.


NVRAM 에서 데이터 집계로의 ONTAP Select 디스테이징( ONTAP CP)에는 다음 단계가 포함됩니다.

* 쓰기는 가상 NVRAM 에서 가상 데이터 집계로 역스테이지됩니다.
* 미러 엔진은 두 플렉스에 블록을 동기적으로 복제합니다.

