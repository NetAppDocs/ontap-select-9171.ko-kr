---
sidebar: sidebar 
permalink: concept_stor_vsan_external.html 
keywords: ontap select, vsan and external array configurations, vnas architecture 
summary: '가상 NAS(vNAS) 배포는 vSAN의 ONTAP Select 클러스터, 일부 HCI 제품, NetApp HCI 기술 및 외부 어레이 유형의 데이터 저장소를 지원합니다. 이러한 구성의 기반 인프라는 데이터스토어 복원력을 제공합니다.' 
---
= ONTAP Select vSAN 및 외부 어레이 구성
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
가상 NAS(vNAS) 배포는 가상 SAN(vSAN)의 ONTAP Select 클러스터, 일부 HCI 제품 및 외부 어레이 유형의 데이터 저장소를 지원합니다. 이러한 구성의 기반 인프라는 데이터스토어 복원력을 제공합니다.

최소 요구 사항은 사용 중인 하이퍼바이저(지원되는 Linux 호스트의 VMware ESXi 또는 KVM)가 기본 구성을 지원한다는 것입니다.  하이퍼바이저가 ESXi인 경우 해당 VMware HCL에 나열되어야 합니다.



== vNAS 아키텍처

vNAS 명명법은 DAS를 사용하지 않는 모든 설정에 사용됩니다. 다중 노드 ONTAP Select 클러스터의 경우 동일한 HA 쌍에 있는 두 ONTAP Select 노드가 단일 데이터 저장소(vSAN 데이터 저장소 포함)를 공유하는 아키텍처가 여기에 포함됩니다. 노드는 동일한 공유 외부 어레이의 별도 데이터 저장소에 설치할 수도 있습니다. 이를 통해 어레이 측 스토리지 효율성을 높여 전체 ONTAP Select HA 쌍의 전반적인 설치 공간을 줄일 수 있습니다. ONTAP Select vNAS 솔루션의 아키텍처는 로컬 RAID 컨트롤러가 있는 DAS의 ONTAP Select 와 매우 유사합니다. 즉, 각 ONTAP Select 노드는 HA 파트너의 데이터 복사본을 계속 보유합니다. ONTAP 스토리지 효율성 정책은 노드 범위입니다. 따라서 어레이 측 스토리지 효율성은 두 ONTAP Select 노드의 데이터 세트에 적용될 가능성이 있으므로 더 바람직합니다.

HA 쌍의 각 ONTAP Select 노드가 별도의 외부 어레이를 사용할 수도 있습니다. 이는 외부 스토리지와 함께 ONTAP Select Metrocluster SDS를 사용할 때 일반적으로 사용되는 방식입니다.

각 ONTAP Select 노드에 대해 별도의 외부 어레이를 사용하는 경우 두 어레이가 ONTAP Select VM과 유사한 성능 특성을 제공하는 것이 매우 중요합니다.



=== 하드웨어 RAID 컨트롤러가 있는 로컬 DAS 대비 vNAS 아키텍처

vNAS 아키텍처는 논리적으로 DAS와 RAID 컨트롤러를 갖춘 서버 아키텍처와 가장 유사합니다. 두 경우 모두 ONTAP Select 데이터 저장소 공간을 사용합니다. 이 데이터 저장소 공간은 VMDK에 저장되며, 이러한 VMDK는 기존 ONTAP 데이터 집계를 형성합니다. ONTAP Deploy는 클러스터 생성 및 스토리지 추가 작업 중에 VMDK의 크기가 적절하게 조정되고 올바른 플렉스(HA 쌍의 경우)에 할당되도록 합니다.

vNAS와 RAID 컨트롤러가 있는 DAS 사이에는 두 가지 주요 차이점이 있습니다. 가장 직접적인 차이점은 vNAS는 RAID 컨트롤러가 필요하지 않다는 것입니다. vNAS는 기본 외부 어레이가 RAID 컨트롤러가 있는 DAS가 제공하는 것과 같은 데이터 지속성과 복원력을 제공한다고 가정합니다. 두 번째이자 더 미묘한 차이점은 NVRAM 성능과 관련이 있습니다.



== vNAS NVRAM

ONTAP Select NVRAM 은 VMDK입니다. 즉, ONTAP Select 블록 주소 지정 장치(VMDK) 위에 바이트 주소 지정 공간(기존 NVRAM)을 에뮬레이션합니다. 하지만 NVRAM 의 성능은 ONTAP Select 노드의 전반적인 성능에 절대적으로 중요합니다.

하드웨어 RAID 컨트롤러가 있는 DAS 설정의 경우, 하드웨어 RAID 컨트롤러 캐시는 NVRAM 캐시 역할을 합니다. NVRAM VMDK에 대한 모든 쓰기는 먼저 RAID 컨트롤러 캐시에 호스팅되기 때문입니다.

VNAS 아키텍처의 경우, ONTAP Deploy는 SIDL(Single Instance Data Logging)이라는 부팅 인수를 사용하여 ONTAP Select 노드를 자동으로 구성합니다. 이 부팅 인수가 있는 경우, ONTAP Select NVRAM 우회하여 데이터 페이로드를 데이터 집계에 직접 기록합니다. NVRAM WRITE 작업으로 변경된 블록의 주소를 기록하는 데만 사용됩니다. 이 기능의 이점은 NVRAM 에 한 번 쓰고, NVRAM 디스테이징될 때 두 번째 쓰는 이중 쓰기를 방지한다는 것입니다. 이 기능은 RAID 컨트롤러 캐시에 대한 로컬 쓰기의 추가 지연 시간이 무시할 수 있을 정도로 작기 때문에 vNAS에서만 활성화됩니다.

SIDL 기능은 모든 ONTAP Select 스토리지 효율성 기능과 호환되지 않습니다. 다음 명령을 사용하여 집계 수준에서 SIDL 기능을 비활성화할 수 있습니다.

[listing]
----
storage aggregate modify -aggregate aggr-name -single-instance-data-logging off
----
SIDL 기능을 끄면 쓰기 성능이 저하됩니다. 해당 볼륨의 모든 스토리지 효율성 정책이 비활성화된 후 SIDL 기능을 다시 활성화할 수 있습니다.

[listing]
----
volume efficiency stop -all true -vserver * -volume * (all volumes in the affected aggregate)
----


== ESXi에서 vNAS를 사용할 때 ONTAP Select 노드 배치

ONTAP Select 공유 스토리지의 다중 노드 ONTAP Select 클러스터를 지원합니다. ONTAP Deploy를 사용하면 동일한 클러스터에 속하지 않는 한 동일한 ESX 호스트에 여러 ONTAP Select 노드를 구성할 수 있습니다. 이 구성은 VNAS 환경(공유 데이터 저장소)에서만 유효합니다. DAS 스토리지를 사용하는 경우 호스트당 여러 ONTAP Select 인스턴스는 지원되지 않습니다. 이러한 인스턴스는 동일한 하드웨어 RAID 컨트롤러를 두고 경쟁하기 때문입니다.

ONTAP Deploy는 다중 노드 VNAS 클러스터의 초기 배포 시 동일 클러스터의 여러 ONTAP Select 인스턴스가 동일 호스트에 배치되지 않도록 합니다. 다음 그림은 두 호스트에서 교차하는 두 개의 4노드 클러스터를 올바르게 배포한 예를 보여줍니다.

*멀티노드 VNAS 클러스터의 초기 배포*

image:ST_14.jpg["멀티노드 VNAS 클러스터의 초기 배포"]

배포 후 ONTAP Select 노드를 호스트 간에 마이그레이션할 수 있습니다. 이로 인해 동일 클러스터에 속한 두 개 이상의 ONTAP Select 노드가 동일한 기본 호스트를 공유하는 최적화되지 않고 지원되지 않는 구성이 발생할 수 있습니다. NetApp VMware가 동일한 HA 쌍의 노드뿐만 아니라 동일 클러스터의 노드 간에 물리적 분리를 자동으로 유지하도록 VM 반선호도 규칙을 수동으로 생성할 것을 권장합니다.


NOTE: 반친화성 규칙을 사용하려면 ESX 클러스터에서 DRS가 활성화되어 있어야 합니다.

ONTAP Select VM에 대한 반친화성 규칙을 생성하는 방법은 다음 예를 참조하세요. ONTAP Select 클러스터에 두 개 이상의 HA 쌍이 있는 경우, 클러스터의 모든 노드를 이 규칙에 포함해야 합니다.

image:ST_15.jpg["VM/호스트 규칙"]

image:ST_16.jpg["VM/호스트 규칙 편집"]

동일한 ONTAP ONTAP Select 클러스터의 두 개 이상의 ONTAP Select 노드가 다음 이유 중 하나로 인해 동일한 ESX 호스트에서 발견될 가능성이 있습니다.

* VMware vSphere 라이선스 제한으로 인해 DRS가 제공되지 않거나 DRS가 활성화되지 않은 경우 DRS가 제공되지 않습니다.
* VMware HA 작업이나 관리자가 시작한 VM 마이그레이션이 우선하므로 DRS 반친화성 규칙은 우회됩니다.


ONTAP Deploy는 ONTAP Select VM 위치를 사전에 모니터링하지 않습니다. 그러나 클러스터 새로 고침 작업은 ONTAP Deploy 로그에 다음과 같은 지원되지 않는 구성을 반영합니다.

image:ST_17.PNG["ONTAP 배포 로그"]
