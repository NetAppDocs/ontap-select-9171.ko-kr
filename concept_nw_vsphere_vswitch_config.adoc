---
sidebar: sidebar 
permalink: concept_nw_vsphere_vswitch_config.html 
keywords: ontap select, standard and distributed vSwitch configurations, vSwitch configuration and load-balancing policies 
summary: ONTAP Select . 
---
= ESXi에서 ONTAP Select VMware vSphere vSwitch 구성
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
ONTAP Select .

ONTAP Select 표준 및 분산 vSwitch 구성 사용을 모두 지원합니다. 분산 vSwitch는 링크 집계 구조(LACP)를 지원합니다. 링크 집계는 여러 물리적 어댑터에서 대역폭을 집계하는 데 사용되는 일반적인 네트워크 구조입니다. LACP는 물리적 네트워크 포트 그룹을 단일 논리 채널로 묶는 네트워크 엔드포인트에 대한 개방형 프로토콜을 제공하는 공급업체 중립적인 표준입니다. ONTAP Select 링크 집계 그룹(LAG)으로 구성된 포트 그룹과 함께 작동할 수 있습니다. 그러나 NetApp LAG 구성을 피하기 위해 개별 물리적 포트를 단순 업링크(트렁크) 포트로 사용할 것을 권장합니다. 이 경우 표준 vSwitch와 분산 vSwitch의 모범 사례는 동일합니다.

이 섹션에서는 2-NIC 및 4-NIC 구성 모두에서 사용해야 하는 vSwitch 구성과 부하 분산 정책에 대해 설명합니다.

ONTAP Select 에서 사용할 포트 그룹을 구성할 때는 다음 모범 사례를 따라야 합니다. 포트 그룹 수준의 부하 분산 정책은 "원점 가상 포트 ID 기반 경로"입니다. VMware는 ESXi 호스트에 연결된 스위치 포트에서 STP를 Portfast로 설정할 것을 권장합니다.

모든 vSwitch 구성에는 최소 두 개의 물리적 네트워크 어댑터가 하나의 NIC 팀으로 묶여 있어야 합니다. ONTAP Select 2노드 클러스터에 대해 단일 10Gb 링크를 지원합니다. 그러나 NetApp NIC 통합을 통해 하드웨어 이중화를 보장하는 것이 모범 사례입니다.

vSphere 서버에서 NIC 팀은 여러 물리적 네트워크 어댑터를 단일 논리 채널로 묶어 모든 멤버 포트에서 네트워크 부하를 공유할 수 있도록 하는 통합 구조입니다. NIC 팀은 물리적 스위치의 지원 없이도 생성될 수 있다는 점을 기억해야 합니다. 로드 밸런싱 및 장애 조치 정책은 업스트림 스위치 구성을 인식하지 못하는 NIC 팀에 직접 적용될 수 있습니다. 이 경우 정책은 아웃바운드 트래픽에만 적용됩니다.


NOTE: ONTAP Select 에서는 정적 포트 채널이 지원되지 않습니다. LACP 지원 채널은 분산 vSwitch에서 지원되지만, LACP LAG를 사용하면 LAG 구성원 간에 부하가 고르지 않게 분산될 수 있습니다.

단일 노드 클러스터의 경우, ONTAP Deploy는 ONTAP Select VM이 외부 네트워크에 포트 그룹을 사용하고, 클러스터 및 노드 관리 트래픽에는 동일한 포트 그룹 또는 선택적으로 다른 포트 그룹을 사용하도록 구성합니다. 단일 노드 클러스터의 경우, 원하는 수의 물리적 포트를 활성 어댑터로 외부 포트 그룹에 추가할 수 있습니다.

다중 노드 클러스터의 경우, ONTAP Deploy는 각 ONTAP Select VM이 내부 네트워크에 하나 또는 두 개의 포트 그룹을 사용하고, 외부 네트워크에도 각각 하나 또는 두 개의 포트 그룹을 사용하도록 구성합니다. 클러스터 및 노드 관리 트래픽은 외부 트래픽과 동일한 포트 그룹을 사용하거나, 선택적으로 별도의 포트 그룹을 사용할 수 있습니다. 클러스터 및 노드 관리 트래픽은 내부 트래픽과 동일한 포트 그룹을 공유할 수 없습니다.


NOTE: ONTAP Select 최대 4개의 VMNIC를 지원합니다.



== 표준 또는 분산 vSwitch 및 노드당 4개의 물리적 포트

다중 노드 클러스터의 각 노드에는 4개의 포트 그룹을 할당할 수 있습니다. 각 포트 그룹에는 다음 그림과 같이 활성 물리적 포트 1개와 대기 물리적 포트 3개가 있습니다.

*노드당 4개의 물리적 포트가 있는 vSwitch*

image:DDN_08.jpg["노드당 4개의 물리적 포트가 있는 vSwitch"]

대기 목록에 있는 포트의 순서는 중요합니다. 다음 표는 네 개의 포트 그룹에 걸친 물리적 포트 분포의 예를 보여줍니다.

*네트워크 최소 및 권장 구성*

[cols="5*"]
|===
| 포트 그룹 | 외부 1 | 외부 2 | 내부 1 | 내부 2 


| 활동적인 | vmnic0 | vmnic1 | vmnic2 | vmnic3 


| 대기 1 | vmnic1 | vmnic0 | vmnic3 | vmnic2 


| 대기 2 | vmnic2 | vmnic3 | vmnic0 | vmnic1 


| 대기 3 | vmnic3 | vmnic2 | vmnic1 | vmnic0 
|===
다음 그림은 vCenter UI(ONTAP-External 및 ONTAP-External2)에서 외부 네트워크 포트 그룹의 구성을 보여줍니다. 활성 어댑터는 서로 다른 네트워크 카드에 속합니다. 이 설정에서 vmnic 4와 vmnic 5는 동일한 물리적 NIC에 연결된 이중 포트이고, vmnic 6과 vminc 7은 별도의 NIC에 연결된 이중 포트입니다(이 예에서는 vnmics 0~3은 사용하지 않음). 대기 어댑터의 순서는 내부 네트워크의 포트가 마지막이 되도록 계층적 장애 조치를 제공합니다. 대기 목록에 있는 내부 포트의 순서도 마찬가지로 두 외부 포트 그룹 간에 바뀝니다.

*1부: ONTAP Select 외부 포트 그룹 구성*

image:DDN_09.jpg["1부: ONTAP Select"]

*2부: ONTAP Select 외부 포트 그룹 구성*

image:DDN_10.jpg["2부: ONTAP Select"]

가독성을 위해 할당은 다음과 같습니다.

[cols="2*"]
|===
| ONTAP- 외부 | ONTAP 외부2 


| 활성 어댑터: vmnic5 대기 어댑터: vmnic7, vmnic4, vmnic6 | 활성 어댑터: vmnic7 대기 어댑터: vmnic5, vmnic6, vmnic4 
|===
다음 그림은 내부 네트워크 포트 그룹(ONTAP-Internal 및 ONTAP-Internal2)의 구성을 보여줍니다. 활성 어댑터는 서로 다른 네트워크 카드에 속합니다. 이 설정에서 vmnic 4와 vmnic 5는 동일한 물리적 ASIC에 있는 듀얼 포트이고, vmnic 6과 vmnic 7도 마찬가지로 별도의 ASIC에 있는 듀얼 포트입니다. 대기 어댑터의 순서는 외부 네트워크의 포트가 마지막이 되는 계층적 장애 조치를 제공합니다. 대기 목록에 있는 외부 포트의 순서도 마찬가지로 두 내부 포트 그룹 간에 바뀝니다.

*1부: ONTAP Select 내부 포트 그룹 구성*

image:DDN_11.jpg["1부: ONTAP Select"]

*2부: ONTAP Select *

image:DDN_12.jpg["2부: ONTAP Select"]

가독성을 위해 할당은 다음과 같습니다.

[cols="2*"]
|===
| ONTAP- 내부 | ONTAP-내부2 


| 활성 어댑터: vmnic4 대기 어댑터: vmnic6, vmnic5, vmnic7 | 활성 어댑터: vmnic6 대기 어댑터: vmnic4, vmnic7, vmnic5 
|===


== 표준 또는 분산 vSwitch 및 노드당 2개의 물리적 포트

고속(25/40Gb) NIC 두 개를 사용할 때 권장되는 포트 그룹 구성은 10Gb 어댑터 네 개를 사용하는 구성과 개념적으로 매우 유사합니다. 물리적 어댑터를 두 개만 사용하더라도 포트 그룹 네 개를 사용해야 합니다. 포트 그룹 할당은 다음과 같습니다.

[cols="5*"]
|===
| 포트 그룹 | 외부 1(e0a,e0b) | 내부 1(e0c,e0e) | 내부 2(e0d,e0f) | 외부 2(e0g) 


| 활동적인 | vmnic0 | vmnic0 | vmnic1 | vmnic1 


| 대기 | vmnic1 | vmnic1 | vmnic0 | vmnic0 
|===
*노드당 2개의 고속(25/40Gb) 물리적 포트가 있는 vSwitch*

image:DDN_17.jpg["노드당 2개의 고속(25/40Gb) 물리적 포트가 있는 vSwitch"]

두 개의 물리적 포트(10Gb 이하)를 사용하는 경우, 각 포트 그룹에는 활성 어댑터와 대기 어댑터가 서로 반대 방향으로 구성되어야 합니다. 내부 네트워크는 다중 노드 ONTAP Select 클러스터에만 존재합니다. 단일 노드 클러스터의 경우, 두 어댑터 모두 외부 포트 그룹에서 활성으로 구성할 수 있습니다.

다음 예는 다중 노드 ONTAP Select 클러스터의 내부 및 외부 통신 서비스 처리를 담당하는 vSwitch와 두 개의 포트 그룹의 구성을 보여줍니다. 내부 네트워크 VMNIC는 이 포트 그룹의 일부이고 대기 모드로 구성되므로 네트워크 중단 시 외부 네트워크는 내부 네트워크 VMNIC를 사용할 수 있습니다. 외부 네트워크의 경우는 그 반대입니다. 네트워크 중단 시 ONTAP ONTAP Select VM의 적절한 장애 조치를 위해서는 두 포트 그룹 간에 활성 VMNIC와 대기 VMNIC를 번갈아 사용하는 것이 중요합니다.

*노드당 2개의 물리적 포트(10Gb 이하)가 있는 vSwitch*

image:DDN_13.jpg["노드당 2개의 물리적 포트가 있는 vSwitch"]



== LACP를 사용한 분산 vSwitch

구성에서 분산 vSwitch를 사용할 경우, 네트워크 구성을 간소화하기 위해 LACP를 사용할 수 있습니다(권장 사항은 아님). 지원되는 유일한 LACP 구성은 모든 VMNIC가 단일 LAG에 있어야 합니다. 업링크 물리적 스위치는 채널의 모든 포트에서 7,500에서 9,000 사이의 MTU 크기를 지원해야 합니다. 내부 및 외부 ONTAP Select 네트워크는 포트 그룹 수준에서 격리되어야 합니다. 내부 네트워크는 라우팅 불가능한(격리된) VLAN을 사용해야 합니다. 외부 네트워크는 VST, EST 또는 VGT를 사용할 수 있습니다.

다음 예에서는 LACP를 사용한 분산 vSwitch 구성을 보여줍니다.

*LACP 사용 시 LAG 속성*

image:DDN_14.jpg["LACP를 사용할 때 LAG 속성"]

*LACP가 활성화된 분산 vSwitch를 사용한 외부 포트 그룹 구성*

image:DDN_15.jpg["LACP가 활성화된 분산 vSwitch를 사용한 외부 포트 그룹 구성"]

*LACP가 활성화된 분산 vSwitch를 사용한 내부 포트 그룹 구성*

image:DDN_16.jpg["LACP가 활성화된 분산 vSwitch를 사용한 내부 포트 그룹 구성"]


NOTE: LACP를 사용하려면 업스트림 스위치 포트를 포트 채널로 구성해야 합니다. 분산 vSwitch에서 이 기능을 활성화하기 전에 LACP 지원 포트 채널이 제대로 구성되어 있는지 확인하십시오.
