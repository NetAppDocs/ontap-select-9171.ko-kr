---
sidebar: sidebar 
permalink: concept_ha_other.html 
keywords: ontap select, ha, high availability, disk heartbeating, heartbeating, mailbox, failover, giveback 
summary: HA 디스크 하트비팅, HA 사서함, HA 하트비팅, HA 장애 조치 및 Giveback 기능은 데이터 보호를 강화합니다. 
---
= ONTAP Select HA는 데이터 보호를 강화합니다.
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
고가용성(HA) 디스크 하트비팅, HA 사서함, HA 하트비팅, HA 장애 조치 및 Giveback 기능은 데이터 보호를 강화합니다.



== 디스크 하트비트

ONTAP Select HA 아키텍처는 기존 FAS 어레이에서 사용되는 많은 코드 경로를 활용하지만, 몇 가지 예외가 있습니다. 이러한 예외 중 하나는 디스크 기반 하트비팅 구현입니다. 디스크 기반 하트비팅은 클러스터 노드가 네트워크 격리로 인해 분할 브레인(split-brain) 현상이 발생하는 것을 방지하기 위해 사용하는 비네트워크 기반 통신 방식입니다. 분할 브레인 시나리오는 일반적으로 네트워크 장애로 인해 발생하는 클러스터 분할의 결과이며, 각 노드는 상대방의 시스템 다운을 감지하고 클러스터 리소스를 점유하려고 시도합니다.

엔터프라이즈급 HA 구현은 이러한 유형의 시나리오를 원활하게 처리해야 합니다. ONTAP 맞춤형 디스크 기반 하트비트 방식을 통해 이를 수행합니다. 이는 클러스터 노드가 하트비트 메시지를 전달하는 데 사용되는 물리적 스토리지의 위치인 HA 사서함에서 담당합니다. 이를 통해 클러스터는 연결을 확인하고 장애 조치 시 쿼럼을 정의할 수 있습니다.

공유 스토리지 HA 아키텍처를 사용하는 FAS 어레이에서 ONTAP 다음과 같은 방법으로 스플릿 브레인 문제를 해결합니다.

* SCSI 영구 예약
* 영구 HA 메타데이터
* HA 상호 연결을 통해 전송된 HA 상태


그러나 ONTAP Select 클러스터의 공유되지 않는 아키텍처 내에서는 노드가 자신의 로컬 스토리지만 볼 수 있고 HA 파트너의 로컬 스토리지는 볼 수 없습니다. 따라서 네트워크 분할을 통해 HA 쌍의 각 노드가 분리되면 클러스터 쿼럼 및 장애 조치 동작을 결정하는 기존 방법을 사용할 수 없습니다.

기존의 분할 브레인 감지 및 방지 방법을 사용할 수는 없지만, 공유되지 않는 환경의 제약 조건을 충족하는 중재 방법이 여전히 필요합니다. ONTAP Select 기존 사서함 인프라를 더욱 확장하여 네트워크 분할 시 중재 방법으로 사용할 수 있도록 합니다. 공유 스토리지를 사용할 수 없으므로, NAS를 통해 사서함 디스크에 액세스하여 중재가 수행됩니다. 이러한 디스크는 iSCSI 프로토콜을 사용하여 2노드 클러스터의 중재자를 포함한 클러스터 전체에 분산됩니다. 따라서 클러스터 노드는 이러한 디스크에 대한 액세스를 기반으로 지능적인 장애 조치(failover) 결정을 내릴 수 있습니다. 노드가 HA 파트너 외부의 다른 노드의 사서함 디스크에 액세스할 수 있다면 정상 작동 중일 가능성이 높습니다.


NOTE: 클러스터 쿼럼과 스플릿 브레인 문제를 해결하기 위한 사서함 아키텍처와 디스크 기반 하트비팅 방식은 ONTAP Select 의 다중 노드 변형이 2노드 클러스터의 경우 4개의 별도 노드 또는 메디에이터를 필요로 하는 이유입니다.



== HA 사서함 게시

HA 사서함 아키텍처는 메시지 게시 모델을 사용합니다. 클러스터 노드는 반복적으로 메시지를 게시하여 중재자를 포함한 클러스터 전체의 다른 모든 사서함 디스크에 노드가 정상 작동 중임을 알립니다. 정상 클러스터 내에서는 어느 시점에서든 클러스터 노드의 단일 사서함 디스크에 다른 모든 클러스터 노드에서 게시된 메시지가 있습니다.

각 Select 클러스터 노드에는 공유 사서함 액세스에 특별히 사용되는 가상 디스크가 연결됩니다. 이 디스크는 노드 장애 또는 네트워크 분할 시 클러스터 중재 방식으로 작동하는 것이 주 기능이므로 중재자 사서함 디스크라고 합니다. 이 사서함 디스크는 각 클러스터 노드에 대한 파티션을 포함하고 있으며 다른 Select 클러스터 노드에 의해 iSCSI 네트워크를 통해 마운트됩니다. 이러한 노드는 주기적으로 사서함 디스크의 해당 파티션에 상태를 게시합니다. 클러스터 전체에 분산된 네트워크 액세스 가능 사서함 디스크를 사용하면 도달 가능성 매트릭스를 통해 노드 상태를 유추할 수 있습니다. 예를 들어, 클러스터 노드 A와 B는 클러스터 노드 D의 사서함에는 게시할 수 있지만 노드 C의 사서함에는 게시할 수 없습니다. 또한 클러스터 노드 D는 노드 C의 사서함에 게시할 수 없으므로 노드 C가 다운되었거나 네트워크가 분리되어 있을 가능성이 높으며, 노드 C를 인계해야 합니다.



== 하 심장이 뛰다

NetApp FAS 플랫폼과 마찬가지로 ONTAP Select HA 상호 연결을 통해 주기적으로 HA 하트비트 메시지를 전송합니다. ONTAP Select 클러스터 내에서는 HA 파트너 간에 존재하는 TCP/IP 네트워크 연결을 통해 이 작업이 수행됩니다. 또한, 디스크 기반 하트비트 메시지가 중재자 사서함 디스크를 포함한 모든 HA 사서함 디스크로 전달됩니다. 이러한 메시지는 몇 초 간격으로 전달되고 주기적으로 읽힙니다. 이러한 메시지의 송수신 빈도 덕분에 ONTAP Select 클러스터는 FAS 플랫폼에서 제공하는 것과 동일한 약 15초 이내에 HA 장애 이벤트를 감지할 수 있습니다. 하트비트 메시지를 더 이상 읽지 않으면 장애 조치 이벤트가 트리거됩니다.

다음 그림은 단일 ONTAP Select 클러스터 노드인 노드 C의 관점에서 HA 상호 연결 및 중재자 디스크를 통해 하트비트 메시지를 보내고 받는 프로세스를 보여줍니다.


NOTE: 네트워크 하트비트는 HA 상호 연결을 통해 HA 파트너인 노드 D로 전송되는 반면, 디스크 하트비트는 모든 클러스터 노드 A, B, C, D의 사서함 디스크를 사용합니다.

*4노드 클러스터의 HA 하트비트: 정상 상태*image:DDHA_05.jpg["4노드 클러스터의 HA 하트비트: 정상 상태"]



== HA 장애 조치 및 반환

장애 조치(failover) 작업 중, 정상 작동 중인 노드는 HA 파트너 데이터의 로컬 복사본을 사용하여 피어 노드의 데이터 제공 책임을 맡습니다. 클라이언트 I/O는 중단 없이 계속될 수 있지만, 이 데이터의 변경 사항은 반드시 복구(giveback) 전에 복제되어야 합니다. ONTAP Select 강제 복구를 지원하지 않습니다. 강제 복구를 수행하면 정상 작동 중인 노드에 저장된 변경 사항이 손실되기 때문입니다.

재부팅된 노드가 클러스터에 다시 참여하면 동기화 백 작업이 자동으로 트리거됩니다. 동기화 백에 걸리는 시간은 여러 요인에 따라 달라집니다. 이러한 요인에는 복제해야 하는 변경 사항 수, 노드 간 네트워크 지연 시간, 각 노드의 디스크 하위 시스템 속도 등이 있습니다. 동기화 백에 걸리는 시간이 자동 백 처리 시간인 10분을 초과할 수 있습니다. 이 경우, 동기화 백 처리 후 수동으로 백 처리를 수행해야 합니다. 다음 명령을 사용하여 동기화 백 처리 진행 상황을 모니터링할 수 있습니다.

[listing]
----
storage aggregate status -r -aggregate <aggregate name>
----